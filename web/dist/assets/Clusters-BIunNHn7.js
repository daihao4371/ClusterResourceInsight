import{d as ue,r as c,a as ie,c as D,o as de,b as ce,e as I,f as n,g as t,w as a,u as f,p as _e,h as r,i as L,j as pe,k as h,E as d,l as i,t as _,m as fe,n as ve,q as me,s as ge,v as be,x as ye,y as he,z as we,_ as Ce}from"./index-I938XGX1.js";const ke={class:"clusters-container"},Ve={class:"page-header"},xe={class:"header-actions"},Te={class:"stat-content"},Ue={class:"stat-value"},$e={class:"stat-content"},Be={class:"stat-value online"},Me={class:"stat-content"},Se={class:"stat-value offline"},Ae={class:"stat-content"},De={class:"stat-value unknown"},Ee={class:"card-header"},Ie={class:"search-box"},Le={class:"cluster-name"},qe={class:"dialog-footer"},ze=ue({__name:"Clusters",setup(Fe){const k=c(!1),M=c(!1),S=c(!1),b=c(!1),w=c(!1),V=c(""),x=c(""),p=c([]),T=c([]),U=c(),o=ie({cluster_name:"",cluster_alias:"",api_server:"",auth_type:"token",auth_config:{bearer_token:""},tags:[],collect_interval:30}),q=D(()=>p.value.filter(l=>l.status==="online").length),z=D(()=>p.value.filter(l=>l.status==="offline").length),F=D(()=>p.value.filter(l=>l.status==="unknown").length),N={cluster_name:[{required:!0,message:"请输入集群名称",trigger:"blur"}],api_server:[{required:!0,message:"请输入API Server地址",trigger:"blur"},{type:"url",message:"请输入有效的URL",trigger:"blur"}],auth_type:[{required:!0,message:"请选择认证类型",trigger:"change"}],auth_config:[{required:!0,message:"请输入认证配置",trigger:"blur"}]},P=l=>new Date(l).toLocaleString("zh-CN"),R=l=>({online:"success",offline:"danger",unknown:"warning"})[l]||"info",K=l=>({online:"在线",offline:"离线",unknown:"未知"})[l]||l,j=()=>({token:"Bearer Token",cert:"客户端证书内容",kubeconfig:"Kubeconfig文件内容"})[o.auth_type]||"",C=async()=>{try{k.value=!0;const l=await h.getClusters();p.value=l.data||[],T.value=p.value}catch(l){console.error("加载集群列表失败:",l),d.error("获取集群列表失败")}finally{k.value=!1}},O=()=>{if(!V.value.trim()){T.value=p.value;return}const l=V.value.toLowerCase();T.value=p.value.filter(e=>{var u;return e.cluster_name.toLowerCase().includes(l)||((u=e.cluster_alias)==null?void 0:u.toLowerCase().includes(l))||e.api_server.toLowerCase().includes(l)})},G=()=>{C()},H=()=>{w.value=!1,b.value=!0},J=l=>{w.value=!0,o.cluster_name=l.cluster_name,o.cluster_alias=l.cluster_alias||"",o.api_server=l.api_server,o.auth_type=l.auth_type,o.collect_interval=l.collect_interval,o.id=l.id,b.value=!0},Q=()=>{var l;Object.assign(o,{cluster_name:"",cluster_alias:"",api_server:"",auth_type:"token",auth_config:{bearer_token:""},tags:[],collect_interval:30}),x.value="",(l=U.value)==null||l.resetFields()},W=async()=>{if(U.value)try{await U.value.validate(),M.value=!0,o.tags=x.value.split(",").map(l=>l.trim()).filter(l=>l.length>0),w.value?(await h.updateCluster(o.id,o),d.success("集群更新成功")):(await h.createCluster(o),d.success("集群创建成功")),b.value=!1,await C()}catch(l){console.error("保存集群失败:",l),d.error("保存集群失败")}finally{M.value=!1}},X=async l=>{try{l.testing=!0;const e=await h.testCluster(l.id);e.success?d.success(`集群 ${l.cluster_name} 连接正常`):d.warning(`集群 ${l.cluster_name} 连接失败: ${e.message}`)}catch(e){console.error("测试集群连接失败:",e),d.error("测试集群连接失败")}finally{l.testing=!1}},Y=async()=>{try{S.value=!0;const l=await h.batchTestClusters();let e=0,u=0;l.forEach(v=>{v.success?e++:u++}),d.info(`批量测试完成: 成功 ${e} 个，失败 ${u} 个`),await C()}catch(l){console.error("批量测试失败:",l),d.error("批量测试失败")}finally{S.value=!1}},Z=async l=>{try{await we.confirm(`确定要删除集群 "${l.cluster_name}" 吗？此操作不可撤销。`,"确认删除",{confirmButtonText:"删除",cancelButtonText:"取消",type:"warning"}),await h.deleteCluster(l.id),d.success("集群删除成功"),await C()}catch(e){e!=="cancel"&&(console.error("删除集群失败:",e),d.error("删除集群失败"))}};return de(()=>{C()}),(l,e)=>{const u=r("el-button"),v=r("el-card"),$=r("el-col"),ee=r("el-row"),y=r("el-input"),B=r("el-icon"),m=r("el-table-column"),te=r("el-tag"),le=r("el-table"),g=r("el-form-item"),A=r("el-option"),ae=r("el-select"),se=r("el-input-number"),oe=r("el-form"),ne=r("el-dialog"),re=ve("loading");return I(),ce("div",ke,[n("div",Ve,[e[13]||(e[13]=n("div",{class:"header-left"},[n("h1",null,"集群管理"),n("p",{class:"subtitle"},"管理和监控 Kubernetes 集群配置")],-1)),n("div",xe,[t(u,{type:"primary",onClick:H,icon:f(_e)},{default:a(()=>[...e[10]||(e[10]=[i(" 添加集群 ",-1)])]),_:1},8,["icon"]),t(u,{onClick:Y,loading:S.value,icon:f(L)},{default:a(()=>[...e[11]||(e[11]=[i(" 批量测试 ",-1)])]),_:1},8,["loading","icon"]),t(u,{onClick:G,loading:k.value,icon:f(pe)},{default:a(()=>[...e[12]||(e[12]=[i(" 刷新 ",-1)])]),_:1},8,["loading","icon"])])]),t(ee,{gutter:20,class:"stats-row"},{default:a(()=>[t($,{span:6},{default:a(()=>[t(v,{class:"stat-card"},{default:a(()=>[n("div",Te,[n("div",Ue,_(p.value.length),1),e[14]||(e[14]=n("div",{class:"stat-label"},"总集群数",-1))])]),_:1})]),_:1}),t($,{span:6},{default:a(()=>[t(v,{class:"stat-card"},{default:a(()=>[n("div",$e,[n("div",Be,_(q.value),1),e[15]||(e[15]=n("div",{class:"stat-label"},"在线集群",-1))])]),_:1})]),_:1}),t($,{span:6},{default:a(()=>[t(v,{class:"stat-card"},{default:a(()=>[n("div",Me,[n("div",Se,_(z.value),1),e[16]||(e[16]=n("div",{class:"stat-label"},"离线集群",-1))])]),_:1})]),_:1}),t($,{span:6},{default:a(()=>[t(v,{class:"stat-card"},{default:a(()=>[n("div",Ae,[n("div",De,_(F.value),1),e[17]||(e[17]=n("div",{class:"stat-label"},"未知状态",-1))])]),_:1})]),_:1})]),_:1}),t(v,{class:"clusters-table-card"},{header:a(()=>[n("div",Ee,[e[18]||(e[18]=n("span",null,"集群列表",-1)),n("div",Ie,[t(y,{modelValue:V.value,"onUpdate:modelValue":e[0]||(e[0]=s=>V.value=s),placeholder:"搜索集群...","prefix-icon":f(he),clearable:"",onInput:O},null,8,["modelValue","prefix-icon"])])])]),default:a(()=>[fe((I(),me(le,{data:T.value,style:{width:"100%"},"empty-text":"暂无集群数据"},{default:a(()=>[t(m,{prop:"cluster_name",label:"集群名称",width:"150"},{default:a(({row:s})=>[n("div",Le,[t(B,{class:"cluster-icon"},{default:a(()=>[t(f(ge))]),_:1}),i(" "+_(s.cluster_name),1)])]),_:1}),t(m,{prop:"cluster_alias",label:"别名",width:"120"}),t(m,{prop:"api_server",label:"API Server",width:"200","show-overflow-tooltip":""}),t(m,{prop:"status",label:"状态",width:"100",align:"center"},{default:a(({row:s})=>[t(te,{type:R(s.status)},{default:a(()=>[i(_(K(s.status)),1)]),_:2},1032,["type"])]),_:1}),t(m,{prop:"collect_interval",label:"采集间隔",width:"100",align:"center"},{default:a(({row:s})=>[i(_(s.collect_interval)+"分钟 ",1)]),_:1}),t(m,{prop:"created_at",label:"创建时间",width:"160"},{default:a(({row:s})=>[i(_(P(s.created_at)),1)]),_:1}),t(m,{label:"操作",width:"240",align:"center",fixed:"right"},{default:a(({row:s})=>[t(u,{type:"primary",size:"small",onClick:E=>X(s),loading:s.testing},{default:a(()=>[t(B,null,{default:a(()=>[t(f(L))]),_:1}),e[19]||(e[19]=i(" 测试 ",-1))]),_:1},8,["onClick","loading"]),t(u,{size:"small",onClick:E=>J(s)},{default:a(()=>[t(B,null,{default:a(()=>[t(f(be))]),_:1}),e[20]||(e[20]=i(" 编辑 ",-1))]),_:1},8,["onClick"]),t(u,{type:"danger",size:"small",onClick:E=>Z(s)},{default:a(()=>[t(B,null,{default:a(()=>[t(f(ye))]),_:1}),e[21]||(e[21]=i(" 删除 ",-1))]),_:1},8,["onClick"])]),_:1})]),_:1},8,["data"])),[[re,k.value]])]),_:1}),t(ne,{modelValue:b.value,"onUpdate:modelValue":e[9]||(e[9]=s=>b.value=s),title:w.value?"编辑集群":"添加集群",width:"600px",onClose:Q},{footer:a(()=>[n("span",qe,[t(u,{onClick:e[8]||(e[8]=s=>b.value=!1)},{default:a(()=>[...e[23]||(e[23]=[i("取消",-1)])]),_:1}),t(u,{type:"primary",onClick:W,loading:M.value},{default:a(()=>[i(_(w.value?"更新":"创建"),1)]),_:1},8,["loading"])])]),default:a(()=>[t(oe,{ref_key:"clusterFormRef",ref:U,model:o,rules:N,"label-width":"120px"},{default:a(()=>[t(g,{label:"集群名称",prop:"cluster_name"},{default:a(()=>[t(y,{modelValue:o.cluster_name,"onUpdate:modelValue":e[1]||(e[1]=s=>o.cluster_name=s),placeholder:"请输入集群名称"},null,8,["modelValue"])]),_:1}),t(g,{label:"集群别名",prop:"cluster_alias"},{default:a(()=>[t(y,{modelValue:o.cluster_alias,"onUpdate:modelValue":e[2]||(e[2]=s=>o.cluster_alias=s),placeholder:"请输入集群别名（可选）"},null,8,["modelValue"])]),_:1}),t(g,{label:"API Server",prop:"api_server"},{default:a(()=>[t(y,{modelValue:o.api_server,"onUpdate:modelValue":e[3]||(e[3]=s=>o.api_server=s),placeholder:"https://kubernetes-api-server:6443"},null,8,["modelValue"])]),_:1}),t(g,{label:"认证类型",prop:"auth_type"},{default:a(()=>[t(ae,{modelValue:o.auth_type,"onUpdate:modelValue":e[4]||(e[4]=s=>o.auth_type=s),style:{width:"100%"}},{default:a(()=>[t(A,{label:"Token认证",value:"token"}),t(A,{label:"证书认证",value:"cert"}),t(A,{label:"Kubeconfig",value:"kubeconfig"})]),_:1},8,["modelValue"])]),_:1}),t(g,{label:"认证配置",prop:"auth_config"},{default:a(()=>[t(y,{modelValue:o.auth_config,"onUpdate:modelValue":e[5]||(e[5]=s=>o.auth_config=s),type:"textarea",rows:4,placeholder:j()},null,8,["modelValue","placeholder"])]),_:1}),t(g,{label:"采集间隔",prop:"collect_interval"},{default:a(()=>[t(se,{modelValue:o.collect_interval,"onUpdate:modelValue":e[6]||(e[6]=s=>o.collect_interval=s),min:5,max:1440,"controls-position":"right",style:{width:"200px"}},null,8,["modelValue"]),e[22]||(e[22]=n("span",{style:{"margin-left":"10px",color:"#909399"}},"分钟",-1))]),_:1}),t(g,{label:"集群标签"},{default:a(()=>[t(y,{modelValue:x.value,"onUpdate:modelValue":e[7]||(e[7]=s=>x.value=s),placeholder:"用逗号分隔多个标签"},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue","title"])])}}}),Pe=Ce(ze,[["__scopeId","data-v-b1056255"]]);export{Pe as default};
