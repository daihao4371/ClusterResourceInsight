import{d as K,r as M,a as R,c as S,o as O,b as _,e as c,f as t,g as a,w as r,u as F,j as Q,h as u,I as W,E as X,l as v,G as x,H as P,y as Y,m as Z,J as U,n as $,q as b,t as i,_ as ee}from"./index-I938XGX1.js";const te={class:"pods-container"},se={class:"page-header"},ae={class:"header-actions"},oe={class:"filter-section"},le={class:"filter-group"},ne={class:"filter-group"},re={class:"filter-group"},ce={class:"filter-group"},ue={class:"card-header"},ie={class:"resource-usage"},de={class:"usage-bar"},pe={class:"usage-text"},_e={class:"current"},me={class:"total"},ge={class:"usage-percent"},he={class:"resource-usage"},fe={class:"usage-bar"},ve={class:"usage-text"},be={class:"current"},ye={class:"total"},xe={class:"usage-percent"},Pe={key:0,class:"issues-container"},we={key:0,class:"more-issues"},Ve={key:1,class:"no-issues"},ke={key:0,class:"pagination-container"},qe=K({__name:"Pods",setup(Ce){const f=M(!1),d=M(null),n=R({query:"",namespace:"",cluster:"",page:1,size:20});let y=null;const D=S(()=>{var e;if(!((e=d.value)!=null&&e.pods))return[];const l=new Set(d.value.pods.map(g=>g.cluster_name));return Array.from(l).sort()}),N=S(()=>{var e;if(!((e=d.value)!=null&&e.pods))return[];const l=new Set(d.value.pods.map(g=>g.namespace));return Array.from(l).sort()}),w=l=>{if(l===0)return"0 B";const e=1024,g=["B","KB","MB","GB","TB"],h=Math.floor(Math.log(l)/Math.log(e));return parseFloat((l/Math.pow(e,h)).toFixed(1))+" "+g[h]},V=l=>l>=1e3?parseFloat((l/1e3).toFixed(2))+" 核":l+"m",T=l=>new Date(l).toLocaleString("zh-CN"),m=async()=>{try{f.value=!0;const l=await W.searchPods(n);d.value=l}catch(l){console.error("搜索Pod失败:",l),X.error("获取Pod列表失败")}finally{f.value=!1}},A=()=>{y&&clearTimeout(y),y=setTimeout(()=>{n.page=1,m()},500)},E=()=>{m()},I=l=>{n.page=l,m()};return O(()=>{m()}),(l,e)=>{const g=u("el-button"),h=u("el-option"),k=u("el-select"),j=u("el-input"),G=u("el-input-number"),q=u("el-card"),p=u("el-table-column"),C=u("el-progress"),B=u("el-tag"),L=u("el-table"),H=u("el-pagination"),J=$("loading");return c(),_("div",te,[t("div",se,[e[6]||(e[6]=t("div",{class:"header-left"},[t("h1",null,"Pod管理"),t("p",{class:"subtitle"},"查看和管理集群中的所有Pod资源")],-1)),t("div",ae,[a(g,{onClick:E,loading:f.value,icon:F(Q)},{default:r(()=>[...e[5]||(e[5]=[v(" 刷新 ",-1)])]),_:1},8,["loading","icon"])])]),a(q,{class:"filter-card"},{default:r(()=>[t("div",oe,[t("div",le,[e[7]||(e[7]=t("label",null,"集群:",-1)),a(k,{modelValue:n.cluster,"onUpdate:modelValue":e[0]||(e[0]=o=>n.cluster=o),placeholder:"全部集群",clearable:"",onChange:m},{default:r(()=>[a(h,{label:"全部集群",value:""}),(c(!0),_(x,null,P(D.value,o=>(c(),b(h,{key:o,label:o,value:o},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),t("div",ne,[e[8]||(e[8]=t("label",null,"命名空间:",-1)),a(k,{modelValue:n.namespace,"onUpdate:modelValue":e[1]||(e[1]=o=>n.namespace=o),placeholder:"全部命名空间",clearable:"",onChange:m},{default:r(()=>[a(h,{label:"全部命名空间",value:""}),(c(!0),_(x,null,P(N.value,o=>(c(),b(h,{key:o,label:o,value:o},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),t("div",re,[a(j,{modelValue:n.query,"onUpdate:modelValue":e[2]||(e[2]=o=>n.query=o),placeholder:"搜索Pod名称...","prefix-icon":F(Y),clearable:"",onInput:A},null,8,["modelValue","prefix-icon"])]),t("div",ce,[a(G,{modelValue:n.size,"onUpdate:modelValue":e[3]||(e[3]=o=>n.size=o),min:10,max:100,step:10,"controls-position":"right",style:{width:"120px"},onChange:m},null,8,["modelValue"]),e[9]||(e[9]=t("span",{style:{"margin-left":"8px",color:"#909399"}},"条/页",-1))])])]),_:1}),a(q,{class:"pods-table-card"},{header:r(()=>{var o;return[t("div",ue,[t("span",null,"Pod列表 ("+i(((o=d.value)==null?void 0:o.total)||0)+")",1)])]}),default:r(()=>{var o;return[Z((c(),b(L,{data:((o=d.value)==null?void 0:o.pods)||[],style:{width:"100%"},"empty-text":"暂无Pod数据"},{default:r(()=>[a(p,{prop:"cluster_name",label:"集群",width:"100"}),a(p,{prop:"namespace",label:"命名空间",width:"120"}),a(p,{prop:"pod_name",label:"Pod名称",width:"200","show-overflow-tooltip":""}),a(p,{prop:"node_name",label:"节点",width:"120","show-overflow-tooltip":""}),a(p,{label:"内存使用",width:"140",align:"center"},{default:r(({row:s})=>[t("div",ie,[t("div",de,[a(C,{percentage:Math.min(s.memory_req_pct,100),status:s.memory_req_pct<20?"exception":s.memory_req_pct>80?"warning":"success","stroke-width":6,"show-text":!1},null,8,["percentage","status"])]),t("div",pe,[t("span",_e,i(w(s.memory_usage)),1),t("span",me,"/ "+i(w(s.memory_request)),1)]),t("div",ge,i(s.memory_req_pct.toFixed(1))+"%",1)])]),_:1}),a(p,{label:"CPU使用",width:"140",align:"center"},{default:r(({row:s})=>[t("div",he,[t("div",fe,[a(C,{percentage:Math.min(s.cpu_req_pct,100),status:s.cpu_req_pct<15?"exception":s.cpu_req_pct>80?"warning":"success","stroke-width":6,"show-text":!1},null,8,["percentage","status"])]),t("div",ve,[t("span",be,i(V(s.cpu_usage)),1),t("span",ye,"/ "+i(V(s.cpu_request)),1)]),t("div",xe,i(s.cpu_req_pct.toFixed(1))+"%",1)])]),_:1}),a(p,{prop:"status",label:"状态",width:"80",align:"center"},{default:r(({row:s})=>[a(B,{type:s.status==="合理"?"success":"warning",size:"small"},{default:r(()=>[v(i(s.status),1)]),_:2},1032,["type"])]),_:1}),a(p,{prop:"issues",label:"问题","min-width":"200"},{default:r(({row:s})=>[s.issues&&s.issues.length>0?(c(),_("div",Pe,[(c(!0),_(x,null,P(s.issues.slice(0,3),z=>(c(),b(B,{key:z,type:"warning",size:"small",class:"issue-tag"},{default:r(()=>[v(i(z),1)]),_:2},1024))),128)),s.issues.length>3?(c(),_("span",we," +"+i(s.issues.length-3)+"个问题 ",1)):U("",!0)])):(c(),_("span",Ve,"无问题"))]),_:1}),a(p,{prop:"creation_time",label:"创建时间",width:"160"},{default:r(({row:s})=>[v(i(T(s.creation_time)),1)]),_:1})]),_:1},8,["data"])),[[J,f.value]]),d.value?(c(),_("div",ke,[a(H,{"current-page":n.page,"onUpdate:currentPage":e[4]||(e[4]=s=>n.page=s),"page-size":n.size,total:d.value.total,layout:"total, prev, pager, next, jumper",onCurrentChange:I},null,8,["current-page","page-size","total"])])):U("",!0)]}),_:1})])}}}),ze=ee(qe,[["__scopeId","data-v-6db66324"]]);export{ze as default};
